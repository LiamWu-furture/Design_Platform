<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>叠层光电探测器设计系统</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        /* 页面加载指示器 */
        #page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        
        #page-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader-content {
            text-align: center;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ab0303;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .main-container {
            max-width: 800px;
            width: 100%;
            margin: 20px;
        }
        .card-header {
            border-radius: 15px 15px 0 0 !important;
            min-height: 50px;
        }
        .card-header h1 {
            font-size: 22px;
        }
        .input-group-text {
            background-color: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-weight: 600;
        }
        .range-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .range-inputs .form-control {
            flex: 1;
        }
        .range-separator {
            font-weight: 600;
            color: #ab0303;
        }
    </style>
</head>
<body>
    <!-- 页面加载指示器 -->
    <div id="page-loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <p style="color: #ab0303; font-weight: 600;">正在加载...</p>
        </div>
    </div>

    {% include 'navbar.html' %}
    
    <div class="content-wrapper">
        <div class="main-container">
        <div class="card">
            <div class="card-header text-center">
                
            </div>
            <div class="card-body p-3" style="margin-top: 10px;">
                <form action="/thinking" method="POST">
                    <!-- 材料类型 -->
                    <div class="mb-3">
                        <label class="form-label icon-label"><i class="fas fa-layer-group"></i> 材料类型</label>
                        <div class="row">
                            <div class="col-md-4 mb-2">
                                <select class="form-select" id="material_category" required>
                                    <option value="">选择大类...</option>
                                    <option value="量子点">量子点</option>
                                    <option value="单晶材料">单晶材料</option>
                                    <option value="多晶材料">多晶材料</option>
                                    <option value="二维材料">二维材料</option>
                                </select>
                            </div>
                            <div class="col-md-8 mb-2">
                                <input class="form-control" list="material_list" id="material_type" name="material_type" placeholder="选择或输入具体材料..." required disabled>
                                <datalist id="material_list"></datalist>
                            </div>
                        </div>
                    </div>

                    <!-- 禁带宽度范围 -->
                    <div class="mb-3">
                        <label class="form-label icon-label">
                            <i class="fas fa-wave-square"></i>
                            禁带宽度范围 (eV)
                        </label>
                        <div class="range-inputs">
                            <input type="number" class="form-control" name="bandgap_min" 
                                   placeholder="最小值" step="0.1" min="0.1" max="5.0" value="1.0" required>
                            <span class="range-separator">—</span>
                            <input type="number" class="form-control" name="bandgap_max" 
                                   placeholder="最大值" step="0.1" min="0.1" max="5.0" value="2.0" required>
                        </div>
                    </div>

                    <!-- 厚度范围 -->
                    <div class="mb-3">
                        <label class="form-label icon-label">
                            <i class="fas fa-ruler-vertical"></i>
                            厚度范围 (nm)
                        </label>
                        <div class="range-inputs">
                            <input type="number" class="form-control" name="thickness_min" 
                                   placeholder="最小值" step="10" min="10" max="10000" value="100" required>
                            <span class="range-separator">—</span>
                            <input type="number" class="form-control" name="thickness_max" 
                                   placeholder="最大值" step="10" min="10" max="10000" value="500" required>
                        </div>
                    </div>

                    <!-- 目标应用 -->
                    <div class="mb-3">
                        <label for="target_application" class="form-label icon-label">
                            <i class="fas fa-bullseye"></i>
                            目标应用
                        </label>
                        <select class="form-select" id="target_application" name="target_application" required>
                            <option value="">请选择应用场景...</option>
                            <option value="太阳能电池">太阳能电池</option>
                            <option value="光通信">光通信</option>
                            <option value="紫外探测">紫外探测</option>
                            <option value="可见光探测">可见光探测</option>
                            <option value="X射线探测">X射线探测</option>
                            <option value="多光谱成像">多光谱成像</option>
                        </select>
                    </div>

                    <!-- 额外要求 -->
                    <div class="mb-3">
                        <label for="additional_requirements" class="form-label icon-label">
                            <i class="fas fa-list-check"></i>
                            额外要求 (可选)
                        </label>
                        <textarea class="form-control" id="additional_requirements" 
                                  name="additional_requirements" rows="3" 
                                  placeholder="例如：高灵敏度、低暗电流、宽光谱响应、快速响应时间等或指定某一层的材料如吸收层:TiO2..."></textarea>
                    </div>

                    <!-- 深度思考选项 -->
                    <div class="mb-3">
                        <label class="form-label icon-label">
                            <i class="fas fa-bolt-lightning"></i>
                            AI 模型选择
                        </label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="deep_thinking" id="deep_thinking_yes" value="yes" checked>
                            <label class="form-check-label" for="deep_thinking_yes">
                                <strong>深度思考模式</strong> (推理能力更强，耗时较长)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="deep_thinking" id="deep_thinking_no" value="no">
                            <label class="form-check-label" for="deep_thinking_no">
                                <strong>快速模式</strong> (响应更快，适合快速迭代)
                            </label>
                        </div>
                    </div>

                    <!-- 提交按钮 -->
                    <div class="text-center mt-3">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-rocket"></i> 开始设计
                        </button>
                    </div>
                </form>
            </div>
        </div>

            <div class="text-center mt-4">
                <p>
                    <i class="fas fa-info-circle"></i> 
                    Powered by 微纳光学科技创新团队
                </p>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js" defer crossorigin="anonymous"></script>
    <script>
        // 页面加载完成后隐藏加载指示器
        window.addEventListener('load', function() {
            const loader = document.getElementById('page-loader');
            if (loader) {
                loader.classList.add('hidden');
                setTimeout(() => loader.remove(), 300);
            }
        });
        
        // 如果3秒后还没加载完，也隐藏加载指示器（防止卡住）
        setTimeout(function() {
            const loader = document.getElementById('page-loader');
            if (loader && !loader.classList.contains('hidden')) {
                loader.classList.add('hidden');
                setTimeout(() => loader.remove(), 300);
            }
        }, 3000);
    </script>
    <script defer>
        // Hardcoded Material Data
        const materialsData = {
            "量子点": {
                "IV族量子点": ["硅量子点", "锗量子点", "GeSiSn合金量子点"],
                "II-VI族量子点": ["CdSe量子点", "CdTe量子点"],
                "III-V族量子点": ["InP量子点", "InAs量子点"],
                "钙钛矿量子点": ["CsPbCl₃量子点", "CH₃NH₃PbI₃量子点"],
                "I-III-VI族量子点": ["CuInS₂量子点", "AgInS₂量子点"]
            },
            "单晶材料": {
                "半导体单晶": ["硅单晶", "锗单晶", "砷化镓单晶"],
                "功能化合物单晶": ["(HPPh₃)₂MnCl₄单晶"],
                "光学晶体": ["氟化钙单晶", "氟化镁单晶"]
            },
            "多晶材料": {
                "MAX/MAB相材料": ["Ti₂AlC", "Ti₃SiC₂", "Ti₃AlC₂"],
                "结构陶瓷": ["Ti₂AlC-20TiB₂复合材料", "SiC/GNPs复合材料"],
                "功能陶瓷": ["FePc/MXene复合材料", "Ti₃C₂/MnO₂异质结"],
                "纳米多晶": ["十面体冰纳米晶", "二十面体冰纳米晶"]
            },
            "二维材料": {
                "单元素二维材料": ["石墨烯", "硅烯", "黑磷"],
                "过渡金属硫族化合物(TMDs)": ["二硫化钼(MoS₂)", "二硫化钨(WS₂)"],
                "MXenes": ["Ti₃C₂Tₓ", "Ti₃CNTₓ"],
                "氮化物": ["六方氮化硼(h-BN)", "MoSi₂N₄"],
                "层状氧化物/氢氧化物": ["钴铁氢氧化物", "钙钛矿型氧化物"]
            }
        };

        const categorySelect = document.getElementById('material_category');
        const materialInput = document.getElementById('material_type');
        const materialDatalist = document.getElementById('material_list');

        // Add event listener for category change
        if (categorySelect) {
            categorySelect.addEventListener('change', function() {
                const category = this.value;
                console.log("Category selected:", category);
                
                // Clear existing options
                materialDatalist.innerHTML = '';
                materialInput.value = '';
                
                if (category && materialsData[category]) {
                    // Enable input
                    materialInput.disabled = false;
                    
                    const subcategories = materialsData[category];
                    
                    // Populate datalist
                    for (const subcat in subcategories) {
                        const materials = subcategories[subcat];
                        materials.forEach(mat => {
                            const option = document.createElement('option');
                            option.value = mat;
                            materialDatalist.appendChild(option);
                        });
                    }
                    // Focus input
                    materialInput.focus();
                } else {
                    materialInput.disabled = true;
                }
            });
        }

        document.querySelector('form').addEventListener('submit', function(e) {
            const bgMin = parseFloat(document.getElementsByName('bandgap_min')[0].value);
            const bgMax = parseFloat(document.getElementsByName('bandgap_max')[0].value);
            const thickMin = parseFloat(document.getElementsByName('thickness_min')[0].value);
            const thickMax = parseFloat(document.getElementsByName('thickness_max')[0].value);
            
            let hasError = false;
            let errorMsg = '';
            
            if (bgMin > bgMax) {
                errorMsg += '禁带宽度最小值不能大于最大值\n';
                hasError = true;
            }
            
            if (thickMin > thickMax) {
                errorMsg += '厚度最小值不能大于最大值\n';
                hasError = true;
            }
            
            if (hasError) {
                e.preventDefault();
                alert(errorMsg);
            }
        });
    </script>
</body>
</html>
